# Load the Active Directory module
Import-Module ActiveDirectory

# Define the target Organizational Unit (OU) distinguished name
$targetOU = "OU=_DisabledUsers,DC=aspen,DC=com" # Replace with your actual OU path

# Calculate the date six months ago
$sixMonthsAgo = (Get-Date).AddMonths(-6)

# Retrieve all user accounts in the specified OU with their last login date
$users = Get-ADUser -Filter * -SearchBase $targetOU -Properties LastLogonDate

# Filter users whose last login date is older than six months
$usersToDelete = $users | Where-Object { $_.LastLogonDate -lt $sixMonthsAgo }

# Delete the selected user accounts and their associated leaf objects
$usersToDelete | ForEach-Object {
    Write-Host "Deleting user: $($_.SamAccountName) with last login date: $($_.LastLogonDate)"
    Remove-ADObject -Identity $_.DistinguishedName  -Recursive -Confirm:$false
}

Write-Host "Deletion process completed."
